import React, { useState } from "react";
import Head from "next/head";
import Button from "../components/Button";
import { Form, NavForm, InlineEdit } from "../components/Form";
import FloatingButton from "../components/FloatingButton";
import Navbar from "../components/Navbar";
import Hero from "../components/Hero";
import AboutUs from "../components/AboutUs";
import Cards from "../components/Cards";
import Footer from "../components/Footer";

export default function Home() {
  const [contentArray, setContentArray] = useState([]);
  const [isEditView, setEditView] = useState(false);
  const [value, setValue] = useState();

  const addSection = (type) => {
    let arr = [...contentArray];

    if (type === "navbar") {
      setContentArray([
        {
          type: "navbar",
          content: [
            {
              label: "Product",
            },
            {
              label: "Pricing",
            },
          ],
        },
        ...contentArray,
      ]);
    } else if (type === "hero") {
      setContentArray([
        ...contentArray,
        {
          type: "hero",
          content: [
            {
              label: "Website",
            },
            {
              label: "Deliver transparent web-readiness",
            },
          ],
        },
      ]);
    } else if (type === "aboutUs") {
      setContentArray([
        ...contentArray,
        {
          type: "aboutUs",
          content: [
            {
              label: "Deliver Transparent Web-readiness Generation",
            },
            {
              label:
                "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Quid dubitas igitur mutare principia naturae? Ita multo sanguine profuso in laetitia et in victoria est mortuus. Omnia contraria, quos etiam insanos esse vultis. Hinc ceteri particulas arripere conati suam quisque videro voluit afferre sententiam. Quis non odit sordidos, vanos, leves, futtiles? Quasi ego id curem, quid ille aiat aut neget.",
            },
          ],
        },
      ]);
    } else if (type === "pricing") {
      setContentArray([
        ...contentArray,
        {
          type: "pricing",
          content: [
            {
              label: "Free",
            },
            {
              label: "Discounted",
            },
          ],
        },
      ]);
    } else if (type === "footer") {
      setContentArray([
        ...contentArray,
        {
          type: "footer",
          content: [
            {
              label: "About",
            },
            {
              label: "Help",
            },
            {
              label: "Terms",
            },
            {
              label: "Privacy",
            },
          ],
        },
      ]);
    } else {
      arr.push({
        type: "content",
        content: [
          {
            label: "New title",
          },
          {
            label:
              "The generator is an innovative tool that utilizes cross-platform viral AI generation",
          },
        ],
      });
      setContentArray([...arr]);
    }
  };

  const handleEditView = () => {
    setContentArray([...contentArray]);
    setEditView(!isEditView);
  };

  const remove = (index) => {
    // contentArray.splice(index, 1);
    // setContentArray([...contentArray]);

    const arr = [...contentArray];
    setContentArray([...arr.slice(0, index), ...arr.slice(index + 1)]);
  };

  const moveUp = (index) => {
    if (index === 0) {
      return;
    }

    const itemAtIndex = contentArray[index];
    const arr = [...contentArray];

    arr.splice(index, 1, arr[index - 1]);
    arr.splice(index - 1, 1, itemAtIndex);

    setContentArray([...arr]);
  };

  const moveDown = (index) => {
    if (index === contentArray.length - 1) {
      return;
    }

    const itemAtIndex = contentArray[index];
    const arr = [...contentArray];

    arr.splice(index, 1, arr[index + 1]);
    arr.splice(index + 1, 1, itemAtIndex);

    setContentArray([...arr]);
  };

  const addNavbarLink = (index) => {
    let arr = [...contentArray];
    arr[index].content.push({
      label: "Link",
    });
    setContentArray([...arr]);
  };

  const getNavbar = () => {
    const newArr = contentArray.find((content) => content.type === "navbar");
    return newArr;
  };

  const onSubmitNav = (index) => (message) => {
    console.log("message", message);
    let arr = [...contentArray];
    arr[index].content = [...message];
    setContentArray([...arr]);
    setEditView(!isEditView);
  };

  return (
    <div>
      <Head>
        <title>~ The Original ~</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <main>
        {contentArray.map((a, index) => {
          if (a.type === "navbar") {
            return (
              <div key={index}>
                {!isEditView && <Navbar items={a.content} />}
                {getNavbar() && isEditView && (
                  <div className="space-x-2 gap-4">
                    <NavForm
                      content={getNavbar().content}
                      onSubmit={onSubmitNav(index)}
                    />
                    <Button onClick={() => remove(index)}>x</Button>
                    <Button onClick={() => addNavbarLink(index)}>+</Button>
                  </div>
                )}
              </div>
            );
          } else if (a.type === "hero") {
            return (
              <div key={index} className="container mx-auto px-5 w-full">
                {!isEditView && <Hero items={a.content} />}
                {isEditView && (
                  <div className="space-x-2">
                    <NavForm
                      content={contentArray[index].content}
                      onSubmit={onSubmitNav(index)}
                    />
                    <Button onClick={() => moveUp(index)}>↑</Button>
                    <Button onClick={() => moveDown(index)}>↓</Button>
                    <Button onClick={() => remove(index)}>X</Button>
                  </div>
                )}
              </div>
            );
          } else if (a.type === "aboutUs") {
            return (
              <div key={index} className="container mx-auto px-5 w-full">
                {!isEditView && <AboutUs items={a.content} />}
                {isEditView && (
                  <div className="space-x-2">
                    <NavForm
                      content={contentArray[index].content}
                      onSubmit={onSubmitNav(index)}
                    />
                    <Button onClick={() => moveUp(index)}>↑</Button>
                    <Button onClick={() => moveDown(index)}>↓</Button>
                    <Button onClick={() => remove(index)}>X</Button>
                  </div>
                )}
              </div>
            );
          } else if (a.type === "content") {
            return (
              <div
                key={index}
                className="bg-red-300 w-full container mx-auto px-5"
              >
                {/* <InlineEdit value={value} setValue={setValue} /> */}
                <Cards items={a.content} />
              </div>
            );
          } else if (a.type === "footer") {
            return (
              <footer
                key={index}
                className=" bg-accent-1 border-t border-accent-2"
              >
                <Footer items={a.content} />
              </footer>
            );
          } else {
            return (
              <div key={index} className={` w-full px-6`}>
                {contentArray[index].inputFields && (
                  <Form
                    order={index}
                    content={contentArray}
                    isEditView={isEditView}
                  />
                )}
                {isEditView && (
                  <div className="absolute z-10 right-0 space-x-2">
                    <Button onClick={() => moveUp(index)}>↑</Button>
                    <Button onClick={() => moveDown(index)}>↓</Button>
                    <Button onClick={() => remove(index)}>X</Button>
                  </div>
                )}
              </div>
            );
          }
        })}
        <div>
          {contentArray.length !== 0 && (
            <FloatingButton onClick={handleEditView} styles="bottom-6 right-8">
              Edit
            </FloatingButton>
          )}
          {contentArray.findIndex((content) => content.type === "navbar") ===
            -1 && (
            <FloatingButton
              onClick={() => addSection("navbar")}
              color="blue"
              styles="bottom-32 left-8"
            >
              Add Navbar
            </FloatingButton>
          )}
          {contentArray.findIndex((content) => content.type === "footer") ===
            -1 && (
            <FloatingButton
              onClick={() => addSection("footer")}
              color="blue"
              styles="bottom-32 left-32"
            >
              Add Footer
            </FloatingButton>
          )}
          {!isEditView && (
            <>
              <FloatingButton
                onClick={() => addSection("hero")}
                color="blue"
                styles="bottom-6 left-8"
              >
                Hero
              </FloatingButton>
              <FloatingButton
                onClick={() => addSection("aboutUs")}
                color="blue"
                styles="bottom-6 left-32"
              >
                About Us
              </FloatingButton>
              <FloatingButton
                onClick={() => addSection("content")}
                color="blue"
                styles="bottom-6 left-56"
              >
                Content
              </FloatingButton>
            </>
          )}
        </div>
      </main>
    </div>
  );
}
